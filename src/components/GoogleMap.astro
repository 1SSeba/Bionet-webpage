---
const { latitude, longitude } = Astro.props;
---

<div id="map" style="height: 400px; width: 100%;"></div>

<script type="text/javascript">
  function loadGoogleMapsScript(callback) {
    if (window.google && window.google.maps) {
      callback();
    } else {
      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyB6jV5wkpPnXbqXjCm3AxIfwhbnGKvsoH4&callback=${callback.name}`;
      script.async = true;  // Ensure that the script is loaded asynchronously
      script.defer = true;  // Ensure that the script is executed after the document has been parsed
      document.head.appendChild(script);
    }
  }

  function initMap() {
    fetch('/api/gps_data')
      .then(response => response.json())
      .then(data => {
        const lat = parseFloat(data.lat) || 0;
        const lon = parseFloat(data.lon) || 0;
        const latLng = { lat, lng: lon };

        const map = new google.maps.Map(document.getElementById("map"), {
          center: latLng,
          zoom: 15
        });

        new google.maps.Marker({
          position: latLng,
          map: map,
          title: "Current Location"
        });
      })
      .catch(error => {
        console.error('Error fetching GPS data:', error);
      });
  }

  loadGoogleMapsScript(initMap);
</script>
